---
title: "Assignment 3 Task 2"
author: "Sarah Lam"
date: "2/15/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
library(NbClust)
library(ggdendro)
```

### Overview

Task 2: Agglomerative hierarchical clustering (submit html on GS)
A useful descriptive introductory summary (3 - 4 sentences) that helps the audience understand the data (include a citation as necessary) and what you’ll be exploring
For Task 2, use hierarchical clustering by complete linkage to create a dendrogram showing multivariate clustering for water chemistry by site.
To perform hierarchical clustering by site, you’ll want to make a data frame that has a single summary row per site (e.g. based on means from all observations at that site), then calculate the Euclidean distance before performing complete linkage agglomerative hierarchical clustering. 

Citation: Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. Environmental Data Initiative. https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174. 

```{r}
#read in the data 
stream_chemistry <- read_csv(here("data", "sbc_lter_registered_stream_chemistry.csv")) %>% 
  clean_names() %>% 
  na_if(-999.0) %>% 
  drop_na() %>% 
  group_by(site_code)
colnames(stream_chemistry) <- gsub("_u_m", "", colnames(stream_chemistry))

stream_sum <- stream_chemistry %>% #summarize for scale functon
  summarize(nh4 = mean(nh4),
            no3 = mean(no3), 
            po4 = mean(po4), 
            tdn = mean(tdn), 
            tdp = mean(tdp), 
            tpc = mean(tpc), 
            tpp = mean(tpp), 
            tss_mgper_liter = mean(tss_mgper_liter), 
            spec_cond_u_spercm = mean(spec_cond_u_spercm))

stream_scale <- stream_sum %>%
  select(nh4:spec_cond_u_spercm) %>% 
  scale()

rownames(stream_scale) <- stream_sum$site_code #add in site codes as row names
```

```{r}
#creating a dendrogram
stream_dist <- dist(stream_scale, method = 'euclidean', diag = TRUE, upper = TRUE) 
   ### also look at upper and diag arguments
 
# Hierarchical clustering (complete linkage)
stream_hc_complete <- hclust(stream_dist, method = "complete")
 
# Plot it:
ggdendrogram(stream_hc_complete, rotate = TRUE) +
  theme_minimal() +
  labs(x = "Stream Site", 
       y = "Distance",
       title = "Stream Chemistry Site Comparison")
```

**Figure 1.** 